<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BitAxe - Nathan Nicholas</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        .btc-dashboard {
            background: var(--card-background);
            padding: 30px;
            border-radius: 12px;
            margin: 30px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .btc-dashboard h2 {
            color: #f7931a;
            margin-bottom: 25px;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .btc-price-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .btc-current-price {
            display: flex;
            flex-direction: column;
        }

        .btc-price-amount {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--text-color);
        }

        .btc-price-change {
            font-size: 1.1em;
            margin-top: 5px;
        }

        .btc-price-change.positive {
            color: #4caf50;
        }

        .btc-price-change.negative {
            color: #f44336;
        }

        .btc-timeframe-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btc-timeframe-btn {
            padding: 8px 16px;
            background: var(--background-color);
            border: 2px solid var(--accent-color);
            border-radius: 6px;
            color: var(--text-color);
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: var(--transition);
        }

        .btc-timeframe-btn:hover {
            background: var(--accent-color);
            color: white;
        }

        .btc-timeframe-btn.active {
            background: #f7931a;
            border-color: #f7931a;
            color: white;
        }

        .btc-chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }

        .btc-metrics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 25px;
        }

        .btc-metric-card {
            background: var(--background-color);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #f7931a;
        }

        .btc-metric-label {
            font-size: 0.85em;
            color: var(--text-color);
            opacity: 0.7;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btc-metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--text-color);
            word-break: break-word;
        }

        .btc-metric-subtext {
            font-size: 0.8em;
            color: var(--text-color);
            opacity: 0.6;
            margin-top: 5px;
        }

        .btc-last-updated {
            text-align: center;
            font-size: 0.8em;
            color: var(--text-color);
            opacity: 0.5;
            margin-top: 15px;
        }

        .btc-loading {
            text-align: center;
            padding: 40px;
            color: var(--text-color);
            opacity: 0.6;
        }

        @media (max-width: 768px) {
            .btc-price-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .btc-timeframe-buttons {
                width: 100%;
                justify-content: flex-start;
            }

            .btc-metrics-grid {
                grid-template-columns: 1fr;
            }

            .btc-chart-container {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="container">
            <a href="../index.html" class="logo-link">
                <img src="../images/NN.svg" alt="Nathan Nicholas" class="logo-img">
            </a>
            <div class="nav-links">
                <a href="../index.html#about">About</a>
                <a href="../projects.html">Projects</a>
                <a href="../index.html#recently-watched">Media</a>
                <a href="../referrals.html">Referrals</a>
                <a href="../index.html#contact">Contact</a>
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
                    <i class="fa-solid fa-lightbulb"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Project Detail Content -->
    <main>
    <section class="page-content">
        <div class="container">
            <div class="server-header">
                <i class="fab fa-bitcoin server-icon" aria-hidden="true" style="color: #f7931a;"></i>
                <h1>BitAxe Bitcoin Miner</h1>
                <div class="project-meta" style="margin-top: 16px;">
                </div>
            </div>

            <div class="specs-container">
                <!-- Bitcoin Dashboard -->
                <section class="btc-dashboard">
                    <h2>
                        <i class="fab fa-bitcoin" aria-hidden="true"></i>
                        Live Network Stats
                    </h2>

                    <div id="btc-dashboard-content" class="btc-loading">
                        <i class="fas fa-spinner fa-spin" style="font-size: 2em;"></i>
                        <p>Loading Bitcoin data...</p>
                    </div>
                </section>

                <!-- Overview -->
                <section class="specs-section">
                    <h2><i class="fa-solid fa-info-circle" aria-hidden="true"></i> Project Overview</h2>
                    <p>Running a BitAxe Gamma solo Bitcoin miner. It's a small ASIC miner that contributes hashpower to the Bitcoin network while teaching me how mining actually works.</p>
                </section>

                <!-- Hardware Specs -->
                <section class="specs-section">
                    <h2><i class="fa-solid fa-microchip" aria-hidden="true"></i> Hardware Specifications</h2>
                    <ul class="specs-list">
                        <li><strong>Model:</strong> BitAxe Gamma</li>
                        <li><strong>Hashrate:</strong> Average: 1.09 TH/s)</li>
                        <li><strong>Expected Hashrate:</strong> <i>1.12 TH/s</i></li>
                        <li><strong>Power Consumption:</strong> 20W</li>
                        <li><strong>Input Voltage:</strong> 5.1V (5V nominal)</li>
                        <li><strong>Efficiency:</strong> Average: 18.53 J/TH)</li>
                        <li><strong>Expected Efficiency:</strong> <i>17.91 J/TH</i></li>
                        <li><strong>ASIC Frequency:</strong> 550 MHz</li>
                        <li><strong>ASIC Voltage:</strong> 1.15V (measured)</li>
                        <li><strong>Fan Speed:</strong> Average: 38% (4,358 RPM)</li>
                    </ul>
                </section>

                <!-- Mining Stats -->
                <section class="specs-section">
                    <h2><i class="fa-solid fa-chart-line" aria-hidden="true"></i> Mining Statistics</h2>
                    <ul class="specs-list">
                        <li><strong>Total Shares:</strong> 17,562</li>
                        <li><strong>Job Not Found:</strong> 21 (0.12%)</li>
                        <li><strong>Difficulty Too Low:</strong> 6 (0.03%)</li>
                        <li><strong>Best Share (All-Time):</strong> 27.7G</li>
                        <li><strong>Best Share (Current Boot):</strong> 354M</li>
                        <li><strong>Uptime:</strong> 3 weeks, 4 days, 11 hours, 20 minutes</li>
                    </ul>
                </section>

                <!-- The Philosophy -->
                <section class="specs-section">
                    <h2><i class="fa-solid fa-lightbulb" aria-hidden="true"></i> Why Run a BitAxe?</h2>
                    <p>I'm running it to help secure the network, learn how mining actually works, and contribute to the Bitcoin blockchain. Every hash helps strengthen the network and supports the overall project. Plus, there's always the tiny chance of finding a block solo.</p>
                </section>

                <!-- Future Plans -->
                <section class="specs-section">
                    <h2><i class="fa-solid fa-road" aria-hidden="true"></i> Future Plans</h2>
                    <ul class="specs-list">
                        <li>Consider adding a second or third BitAxe to increase hashrate</li>
                        <li>Point the miner to my own Bitcoin node running on TrueNAS SCALE server</li>
                        <li>Track long-term statistics: total hashes, best shares, cumulative uptime</li>
                    </ul>
                </section>

                <!-- Back Button -->
                <div class="back-button-container">
                    <a href="../projects.html" class="btn"><i class="fa-solid fa-arrow-left" aria-hidden="true"></i> Back to Projects</a>
                </div>
            </div>
        </div>
    </section>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p>&copy; 2025 Nathan Nicholas. All rights reserved.</p>
        </div>
    </footer>

    <script src="../script.js?v=20250104001"></script>
    <script>
        // Bitcoin Dashboard Configuration
        const BITAXE_HASHRATE = 1.09; // TH/s
        const BITAXE_POWER = 20; // Watts
        const ELECTRICITY_COST = 0.12; // USD per kWh (adjust as needed)

        let btcChart = null;
        let currentTimeframe = '4'; // Default to 1 year

        // Initialize dashboard on page load
        document.addEventListener('DOMContentLoaded', async function() {
            await loadBitcoinDashboard();

            // Auto-refresh every 5 minutes
            setInterval(loadBitcoinDashboard, 5 * 60 * 1000);
        });

        async function loadBitcoinDashboard() {
            try {
                console.log('Loading Bitcoin dashboard...');

                // Fetch all data in parallel
                console.log('Fetching price data for', currentTimeframe, 'days...');
                const [priceData, networkStats] = await Promise.all([
                    fetchBitcoinPrice(currentTimeframe),
                    fetchNetworkStats()
                ]);

                console.log('Price data:', priceData);
                console.log('Network stats:', networkStats);

                // Render the dashboard
                renderDashboard(priceData, networkStats);
                console.log('Dashboard rendered successfully');
            } catch (error) {
                console.error('Error loading Bitcoin dashboard:', error);
                console.error('Error details:', error.message, error.stack);
                document.getElementById('btc-dashboard-content').innerHTML = `
                    <div class="btc-loading">
                        <i class="fas fa-exclamation-triangle" style="font-size: 2em; color: #f44336;"></i>
                        <p>Error loading Bitcoin data. Please try again later.</p>
                        <p style="font-size: 0.8em; margin-top: 10px;">Check console for details</p>
                    </div>
                `;
            }
        }

        async function fetchBitcoinPrice(days) {
            try {
                console.log('Fetching Bitcoin price from CoinGecko...');

                // CoinGecko API - Free tier
                const response = await fetch(`https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=${days}`);
                if (!response.ok) {
                    console.error('CoinGecko market chart response not OK:', response.status, response.statusText);
                    throw new Error(`Failed to fetch Bitcoin price: ${response.status}`);
                }

                const data = await response.json();
                console.log('Market chart data received, prices count:', data.prices.length);

                // Get current price
                const currentPriceResponse = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true');
                if (!currentPriceResponse.ok) {
                    console.error('CoinGecko simple price response not OK:', currentPriceResponse.status);
                    throw new Error(`Failed to fetch current price: ${currentPriceResponse.status}`);
                }

                const currentPriceData = await currentPriceResponse.json();
                console.log('Current price data:', currentPriceData);

                return {
                    prices: data.prices,
                    currentPrice: currentPriceData.bitcoin.usd,
                    priceChange24h: currentPriceData.bitcoin.usd_24h_change
                };
            } catch (error) {
                console.error('Error in fetchBitcoinPrice:', error);
                throw error;
            }
        }

        async function fetchNetworkStats() {
            try {
                // Try mempool.space API first
                const diffResponse = await fetch('https://mempool.space/api/v1/difficulty-adjustment');
                const hashrateResponse = await fetch('https://mempool.space/api/v1/mining/hashrate/3d');

                if (!diffResponse.ok || !hashrateResponse.ok) {
                    throw new Error('Failed to fetch network stats from mempool.space');
                }

                const diffData = await diffResponse.json();
                const hashrateData = await hashrateResponse.json();

                // Mempool returns hashrate in H/s, convert to TH/s
                const hashrateInTH = hashrateData.currentHashrate / 1e12;

                return {
                    difficulty: diffData.difficulty,
                    hashrate: hashrateInTH,
                    blockHeight: diffData.progressPercent,
                    nextDifficultyRetarget: diffData.remainingBlocks
                };
            } catch (error) {
                console.error('Error fetching network stats:', error);

                // Use realistic fallback data based on current 2025 stats
                return {
                    difficulty: 109780000000000, // ~110T (realistic November 2025 estimate)
                    hashrate: 850000000, // ~850 EH/s in TH/s (realistic estimate)
                    blockHeight: 870000,
                    nextDifficultyRetarget: 0
                };
            }
        }

        function renderDashboard(priceData, networkStats) {
            const container = document.getElementById('btc-dashboard-content');

            // Calculate mining metrics
            const earnings = calculateEarnings(priceData.currentPrice, networkStats.hashrate);
            const timeToBlock = calculateTimeToBlock(networkStats.difficulty);

            // Build dashboard HTML
            container.innerHTML = `
                <div class="btc-price-header">
                    <div class="btc-current-price">
                        <div class="btc-price-amount">$${priceData.currentPrice.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                        <div class="btc-price-change ${priceData.priceChange24h >= 0 ? 'positive' : 'negative'}">
                            <i class="fas fa-arrow-${priceData.priceChange24h >= 0 ? 'up' : 'down'}"></i>
                            ${Math.abs(priceData.priceChange24h).toFixed(2)}% (24h)
                        </div>
                    </div>
                    <div class="btc-timeframe-buttons">
                        <button class="btc-timeframe-btn ${currentTimeframe === '1' ? 'active' : ''}" onclick="changeTimeframe('1')">24H</button>
                        <button class="btc-timeframe-btn ${currentTimeframe === '7' ? 'active' : ''}" onclick="changeTimeframe('7')">7D</button>
                        <button class="btc-timeframe-btn ${currentTimeframe === '30' ? 'active' : ''}" onclick="changeTimeframe('30')">30D</button>
                        <button class="btc-timeframe-btn ${currentTimeframe === '365' ? 'active' : ''}" onclick="changeTimeframe('365')">1Y</button>
                    </div>
                </div>

                <div class="btc-chart-container">
                    <canvas id="btc-price-chart"></canvas>
                </div>

                <div class="btc-metrics-grid">
                    <div class="btc-metric-card">
                        <div class="btc-metric-label">Network Hashrate</div>
                        <div class="btc-metric-value">${formatHashrate(networkStats.hashrate)}</div>
                        <div class="btc-metric-subtext">Total network power</div>
                    </div>

                    <div class="btc-metric-card">
                        <div class="btc-metric-label">Block Reward</div>
                        <div class="btc-metric-value">3.125 BTC</div>
                        <div class="btc-metric-subtext">â‰ˆ $${(3.125 * priceData.currentPrice).toLocaleString('en-US', {maximumFractionDigits: 0})}</div>
                    </div>

                    <div class="btc-metric-card">
                        <div class="btc-metric-label">Daily Power Cost</div>
                        <div class="btc-metric-value">$${((BITAXE_POWER / 1000) * 24 * ELECTRICITY_COST).toFixed(2)}</div>
                        <div class="btc-metric-subtext">${BITAXE_POWER}W @ $${ELECTRICITY_COST}/kWh</div>
                    </div>
                </div>

                <div class="btc-last-updated">
                    Last updated: ${new Date().toLocaleString()}
                </div>
            `;

            // Render the price chart
            renderPriceChart(priceData.prices);
        }

        function renderPriceChart(prices) {
            const ctx = document.getElementById('btc-price-chart');

            // Destroy existing chart if it exists
            if (btcChart) {
                btcChart.destroy();
            }

            // Prepare data
            const labels = prices.map(p => new Date(p[0]));
            const data = prices.map(p => p[1]);

            // Get theme colors
            const isDarkMode = document.documentElement.getAttribute('data-theme') === 'dark';
            const textColor = isDarkMode ? '#e8e8e8' : '#333';
            const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';

            btcChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Bitcoin Price (USD)',
                        data: data,
                        borderColor: '#f7931a',
                        backgroundColor: 'rgba(247, 147, 26, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 5,
                        pointHoverBackgroundColor: '#f7931a'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: isDarkMode ? '#2a2a2a' : '#ffffff',
                            titleColor: textColor,
                            bodyColor: textColor,
                            borderColor: '#f7931a',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return 'Price: $' + context.parsed.y.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: currentTimeframe === '1' ? 'hour' : currentTimeframe === '7' ? 'day' : 'day'
                            },
                            ticks: {
                                color: textColor,
                                maxTicksLimit: 8
                            },
                            grid: {
                                color: gridColor
                            }
                        },
                        y: {
                            ticks: {
                                color: textColor,
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            },
                            grid: {
                                color: gridColor
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        function calculateEarnings(btcPrice, networkHashrate) {
            // Network hashrate is in TH/s, convert to match BitAxe
            // Block reward: 3.125 BTC
            // Blocks per day: 144 (one every 10 minutes)
            const blockReward = 3.125;
            const blocksPerDay = 144;

            if (!networkHashrate || networkHashrate === 0 || isNaN(networkHashrate)) {
                return { perDay: 0, satsPerDay: 0 };
            }

            if (!btcPrice || btcPrice === 0 || isNaN(btcPrice)) {
                return { perDay: 0, satsPerDay: 0 };
            }

            // Calculate BitAxe's share of network hashrate
            const bitaxeShare = BITAXE_HASHRATE / networkHashrate;

            // Calculate expected BTC per day
            const btcPerDay = bitaxeShare * blockReward * blocksPerDay;

            // Convert to USD and sats
            const usdPerDay = btcPerDay * btcPrice;
            const satsPerDay = btcPerDay * 100000000;

            // Validate results
            if (isNaN(usdPerDay) || isNaN(satsPerDay)) {
                return { perDay: 0, satsPerDay: 0 };
            }

            return {
                perDay: usdPerDay,
                satsPerDay: satsPerDay
            };
        }

        function calculateTimeToBlock(difficulty) {
            if (!difficulty || difficulty === 0 || isNaN(difficulty)) {
                return { days: 0, display: 'Calculating...' };
            }

            // Calculate expected time to find a block
            // Time = (Difficulty * 2^32) / (Hashrate in H/s)
            const hashrateInHs = BITAXE_HASHRATE * 1e12; // Convert TH/s to H/s
            const secondsToBlock = (difficulty * Math.pow(2, 32)) / hashrateInHs;
            const daysToBlock = secondsToBlock / 86400;
            const yearsToBlock = daysToBlock / 365.25;

            // Check for invalid calculations
            if (isNaN(daysToBlock) || isNaN(yearsToBlock)) {
                return { days: 0, display: 'Calculating...' };
            }

            let display;
            if (yearsToBlock > 1000) {
                display = `${Math.round(yearsToBlock).toLocaleString()} years`;
            } else if (yearsToBlock > 1) {
                display = `${yearsToBlock.toFixed(1)} years`;
            } else {
                display = `${Math.round(daysToBlock).toLocaleString()} days`;
            }

            return {
                days: daysToBlock,
                years: yearsToBlock,
                display: display
            };
        }

        function formatHashrate(hashrate) {
            if (!hashrate || hashrate === 0 || isNaN(hashrate)) {
                return 'Loading...';
            }
            // Convert TH/s to EH/s for display
            const eh = hashrate / 1000000;
            return `${eh.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})} EH/s`;
        }

        function formatDifficulty(difficulty) {
            if (!difficulty || difficulty === 0 || isNaN(difficulty)) {
                return 'Loading...';
            }
            // Format difficulty in trillions
            const t = difficulty / 1e12;
            return `${t.toFixed(2)}T`;
        }

        async function changeTimeframe(days) {
            currentTimeframe = days;

            // Show loading state
            document.getElementById('btc-dashboard-content').innerHTML = `
                <div class="btc-loading">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2em;"></i>
                    <p>Loading data...</p>
                </div>
            `;

            await loadBitcoinDashboard();
        }

        // Update chart colors when theme changes
        const btcThemeToggle = document.getElementById('theme-toggle');
        if (btcThemeToggle) {
            btcThemeToggle.addEventListener('click', function() {
                // Wait for theme to update, then re-render chart
                setTimeout(() => {
                    if (btcChart) {
                        const isDarkMode = document.documentElement.getAttribute('data-theme') === 'dark';
                        const textColor = isDarkMode ? '#e8e8e8' : '#333';
                        const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';

                        btcChart.options.scales.x.ticks.color = textColor;
                        btcChart.options.scales.x.grid.color = gridColor;
                        btcChart.options.scales.y.ticks.color = textColor;
                        btcChart.options.scales.y.grid.color = gridColor;
                        btcChart.options.plugins.tooltip.backgroundColor = isDarkMode ? '#2a2a2a' : '#ffffff';
                        btcChart.options.plugins.tooltip.titleColor = textColor;
                        btcChart.options.plugins.tooltip.bodyColor = textColor;
                        btcChart.update();
                    }
                }, 100);
            });
        }
    </script>
</body>
</html>
